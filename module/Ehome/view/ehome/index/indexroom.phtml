<?php 
use \Zend\Debug\Debug;

// collect data structures from database
$logMessages = array();
$healthMessages = array();
$warningMessages = array();
foreach($events as $event){
	if ($event->getType() == "message"){
		$logMessages[] = $event;
	}
	if ($event->getType() == "message" && $event->getName() == 'Warnung'){
		$warningMessages[] = $event;
	}
	if ($event->getType() == "health"){
		$healthMessages[] = $event;
	}
}
?>
<!-- DEBUGGING AREA -->
<!-- 
<div class='row'>
        <div class='span12'>
                <h2>Debugging Area</h2>
        </div>
</div>
 -->
<!--
<div class='row'>
	<div class='span6'>
		<h3>TODOs</h3>
		<p>Funktionalitaet: Jalousinen, Aufstehbett, Sturzerkennung, Sturzmonitoring, Waage,
							Licht, Sensornetzwerk Sturzprävention, iPad
		<br>
		UseCases:<br> 
		Naechtlicher Gang - abends wird das Licht angeschalten und das Aufstehbett betätigt, 
							automatisch startet die Beobachtung des Ganges und am Ende entsteht eine 
							Kennzahl ähnlich wie beim Laborbericht beim Bluttest, die Vitaldaten könnten 
							durch einen Zugriff auf die Patientenaktendaten und das Körpergewicht der Waage 
							angereichert werden. Eine zugehörige User-Story lautet: Sie erinnern sich, dass 
							Sie nachts zur Toilette mussten, allerdings durch das Aufstehbett und den moderat
							beleuchteten Gang (jeweils Lampe 2 in Wohnzimmer und Bad) nicht vollkommen wach 
							wurden - sie öffnen das Licht via iPad, die Jalousinen und wollen sich vergewissern welche Sturzrisikokennzahl 
							Sie gestern hatten;<br>
		Schlaue Heizung - Sie starten die Heizung, das System erkennt, dass Sie die Fenster offen haben und warnt;
		Gute Nacht - Sie wollen ins Bett gehen, schalten Sie alle Lichter aus, das System warnt, wenn etwa im Bad das Fenster noch offen ist oder wenn die Tür noch nicht abgeschlossen ist;
		Guten Morgen - Sie stehen morgens auf, das System erkennt Luftfeuchtigkeit und Luftqualität und ermuntert zum Auslüften;
		Blumengiessen - jeden morgen wird in den Blumenvasen der Feuchtigkeitssensor angestoßen und meldet ggf. ob die Pflanzen gegossen werden müssen;
		</p>
		<p>url helper problem, siehe http://stackoverflow.com/questions/20056698/zend-framework-2-url-helper</p>
		<p>Änderung des Layouts - Frage: wie setze ich ein eigenes Layout für das Ehome-Modul?</p>
		<p>Auflisten der Profileinstellungen macht Probleme!</p>
		<p>Problemlösung: man will nach dem Login auf die Seite des IndexControllers, man will dort aber den Link einen Link zu den Profileinstellungen des ZfcUser-Controllers.</p>
		<p>EditRoom-View und Rolle der Datentypen heraus arbeiten.</p>
	</div>
	<div class='span3'>
		<h3>UI-Komponenten</h3>
		<p>
			<a class="btn btn-success" href="" target="_blank">Erfolgsbutton mit Pfeilen &raquo;</a>
		</p>
		<p>
			<a class="btn" href="">Normaler Button</a>
		</p>
	</div>
	<div class='span3'>
		<h3>Actions</h3>
		<p>
			<a class="btn" href="<?php //echo $this->url('home', array('action' => 'temp')); ?>">TempAction</a>
		</p>
	</div>
</div>
-->
<!-- 
<div class='row'>
	<div class='span6'>
		<h3>Events</h3>
		<?php 
//foreach($events as $event){
// 	echo "<p>";
// 	echo "ID : " . $event->getId() . "; ";
// 	echo "name : " . $event->getName() . "; ";
// 	echo "value : " . $event->getValue() . "; ";
// 	echo "type : " . $event->getType() . "; ";
// 	echo "start : " . $event->getStart() . "; ";
// 	echo "end : " . $event->getEnd() . "; ";
// 	echo "done : " . $event->getDone() . "; ";
//     echo "</p>";
//}
		?>
	</div>
	<div class='span6'>
		<h3>Actions</h3>
		<p>
			<a class="btn" href="<?php //echo $this->url('home', array('action' => 'temp')); ?>">TempAction</a>
		</p>
</div>
<hr>
-->
<!-- // DEBUGGING AREA -->
<!-- Startseite -->
<div class="row">
	<div class="span12">
		<p style="text-align: center;">
			<img src='<?php echo $this->basePath(); ?>/img/ehome-center-logo.png'
				alt="Bild Header E|Home-Center" />
		</p>
	</div>
</div>
<div class="hero-unit">
	<h1><?php echo sprintf("Willkommen!", '<span class="zf-green">', '</span>') ?></h1>
	<p>Mustermann, Musterweg 13, 12345 Musterstadt</p>
	<p>
		[<a class="show_hide" href="#" rel="#container">+/-</a>]
	</p>
	<div id="container">
		<div id="background">
			<img alt="apartment_picture"
				src='<?php echo $this->basePath();?>/img/praterstr3.jpg'>
		</div>
		<div id="light_kitchen_one" class="light">
			<img class="img_light" id="img_light_kitchen_one"
				alt="gluehbirne_aus"
				src=<?php
if ($lightoneKitchen) {
        echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
        echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                                ?> />
		</div>
		<div id="light_kitchen_two" class="light">
			<img class="img_light" id="img_light_kitchen_two"
				alt="gluehbirne_aus"
				src=<?php
if ($lighttwoKitchen) {
        echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
        echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                                ?> />
		</div>
		<div id="light_bathroom_one" class="light">
			<img class="img_light" id="img_light_bathroom_one"
				alt="gluehbirne_aus"
				src=<?php
if ($lightoneBath) {
    echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
    echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                ?> />
		</div>
		<div id="light_bathroom_two" class="light">
			<img class="img_light" id="img_light_bathroom_two"
				alt="gluehbirne_aus"
				src=<?php
if ($lighttwoBath) {
    echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
    echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                ?> />
		</div>
		<div id="light_living_one" class="light">
			<img class="img_light" id="img_light_living_one" alt="gluehbirne_aus"
				src=<?php 
if ($lightoneLivingRoom) {
        echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
        echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                                ?> />
		</div>
		<!-- // light-living -->
		<div id="light_living_two" class="light">
			<img class="img_light" id="img_light_living_two" alt="gluehbirne_aus"
				src=<?php 
if ($lighttwoLivingRoom) {
        echo $this->basePath() . '/img/gluehbirne_an.png';
} else {
        echo $this->basePath() . '/img/gluehbirne_aus.png';
}
                                ?> />
		</div>
		<!-- // light-living -->
	</div>
	<!-- // div container -->
</div>
<!-- // hero-unit -->
<hr>
<div class='row'>
	<div class='span4'>
		<h2>Cockpit</h2>
		<div style='float: left; padding-right: 16px;'><?php echo $this->gravatar($this->zfcUserIdentity()->getEmail()); ?>
    </div>
		<p>
    	Angemeldet als <?php echo $useremail; ?>
    </p>
		<p>
			<a class='btn'
				href="<?php echo $this->url('home', array('action' => 'logout')); ?>">Ausloggen</a>
		</p>
	</div>
	<div class='span5'>
		<h2>Hinweise</h2>
<?php 
	foreach($warningMessages as $warningMessage){
		echo "<p style='padding-left: 5px;'> * ";
        //echo $warningMessage->getId() . "; ";
        echo $warningMessage->getName() . ": ";
        echo $warningMessage->getValue() . "; ";
        //echo $warningMessage->getStart() . "; ";
        //echo $warningMessage->getEnd() . "; ";
        //if ($warningMessage->getDone() == 1){
		//	echo "<span style='color: green;'>OK</span>; ";
		//} else {
		//	echo "<span style='color: red;'>ACHTUNG</span>; ";
		//}
        //echo "<a href='' title=''>edit</a>" . "; ";
        //echo "<a href='' title=''>delete</a>" . "; ";
        echo "</p>";
}
?>
	</div>
	<div class='span3'>
		<h2>Hilfe</h2>
		<p>
			Wir helfen Ihnen gerne:<br> support@example.org und 01234-12345
		</p>
	</div>
</div>
<hr>
<div class='row'>
	<div class='span12'>
		<h2>Räume</h2>
		<p>
			[<a class="show_hide" href="#" rel="#rooms">+/-</a>]
		</p>
		<div id="rooms">
			<table border="1px">
				<tr>
					<!-- <th>ID</th> -->
					<th>Name</th>
					<th>Luftfeuchtigkeit</th>
					<th>Temperatur</th>
					<th>LichtEins</th>
					<th>LichtZwei</th>
					<th>Aktion</th>
				</tr>
<?php foreach($this->rooms as $room){
		echo "<tr>";
        //echo "<td>" . $room->getId() . "</td>";
        echo "<td style='text-align: right;'>" . $room->getName() . "</td>";
        echo "<td style='text-align: right;'>" . $room->getHumidity() . "</td>";
        echo "<td style='text-align: right;'>" . $room->getTemperature() . "</td>";
        if ($room->getLightone() == 100){
        	echo "<td style='text-align: right;'>";
        	echo "<span style='color:orange;'>AN </span> ";
        	echo "<a href='" . $this->url('home', array('action' => 'togglelightone' , 'id' => $room->getId())) . "' title='Bearbeiten des Eintrags' class='btn btn-success'><></a>";
			echo "</td>";
        } else {
        	echo "<td style='text-align: right;'>";
        	echo "<span style='color:green;'>AUS</span> ";
        	echo "<a href='" . $this->url('home', array('action' => 'togglelightone' , 'id' => $room->getId())) . "' title='Bearbeiten des Eintrags' class='btn btn-success'><></a>";
        	echo "</td>";
        }
        if ($room->getLighttwo() == 100){
        	echo "<td style='text-align: right;'>";
        	echo "<span style='color:orange;'>AN</span> ";
        	echo "<a href='" . $this->url('home', array('action' => 'togglelighttwo' , 'id' => $room->getId())) . "' title='Bearbeiten des Eintrags' class='btn btn-success'><></a>";
			echo "</td>";
        } else {
        	echo "<td style='text-align: right;'>";
        	echo "<span style='color:green;'>AUS</span> ";
        	echo "<a href='" . $this->url('home', array('action' => 'togglelighttwo' , 'id' => $room->getId())) . "' title='Bearbeiten des Eintrags' class='btn btn-success'><></a>";
			echo "</td>";
        }
        echo "<td><a href='" . $this->url('home', array('action' => 'editroom' , 'id' => $room->getId())) . "' title='Bearbeiten des Eintrags' class='btn btn-success'>Eintreten &raquo;</a>" . "</td>";
        echo "</tr>";
	}
	echo "</table>";

?>
		
		
		</div>
	</div>
</div>
<hr>
<div class="row">
	<div class="span12">
		<h2>Gesundheitsdaten</h2>
		<p>
			[<a class="show_hide" href="#" rel="#health">+/-</a>]
		</p>
		<div id='health'>
<?php 
foreach($healthMessages as $healthMessage){
        echo "<div style='border: 1px solid grey;'>";
		echo "<p style='padding-left: 5px;'>";
        //echo $healthMessage->getId() . "; ";
        echo $healthMessage->getName() . ": ";
        echo $healthMessage->getValue() . "; ";
        echo $healthMessage->getStart() . "; ";
        echo $healthMessage->getEnd() . "; ";
        if ($healthMessage->getDone() == 1){
			echo "<span style='color: green;'>OK</span>; ";
		} else {
			echo "<span style='color: red;'>ACHTUNG</span>; ";
		}
        echo "<a href='' title=''>edit</a>" . "; ";
        echo "<a href='' title=''>delete</a>" . "; ";
        echo "</p>";
        echo "</div>";
}
?>
		</div>
	</div>
</div>
<hr>
<div class="row">
	<div class="span12">
		<h2>Systemnachrichten</h2>
		<p>
			[<a class="show_hide" href="#" rel="#messages">+/-</a>]
		</p>
		<div id='messages'>
<?php 
foreach($logMessages as $logMessage){
        echo "<p>";
        echo $logMessage->getName(); 
        echo "</p>";
}
?>
		</div>
		<!-- RGraph Lib // start -->
		<canvas id="myBar" width="600" height="250">[No canvas support]</canvas>
    	<script>
        window.onload = function()
        {
            var bar = new RGraph.Bar('myBar', [12,13,16,15,16,19,19,12,23,16,13,24])
                .Set('gutter.left', 35)
                .Set('title', 'A basic chart')
                .Set('labels', ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'])
                .Draw();
        }
    	</script>
    	<!-- RGraph Lib // end -->
	</div>
</div>
<!-- 
                 <p>
                        <a class="btn" href="<?php // echo $this->url('clearlog'); ?>">Systemnachrichten l�schen</a>
                </p>

        </div>
</div>
-->
<!-- 
<div class="row">
        <div class="span12">
                <h2>Haussystem</h2>
                <p>
                        Energief�llstand Solaranlage; Anzahl der Benutzer; Datenzugriffe extern;
                </p>
                <p>
                        <a class="btn" href="">Betreten</a>
                </p>
        </div>
</div>
-->
<!-- 
<div class="row">
        <div class="span12">
                <h2>Gemeinschaftsmodul</h2>
                <p>Organisation der Gartenbepflanzung</p>
                <p>
                        <a class="btn" href="">Betreten</a>
                </p>
        </div>
</div>
-->